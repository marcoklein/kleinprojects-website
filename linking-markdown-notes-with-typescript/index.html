

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/fontawesome/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <title>Linking Markdown Notes with TypeScript | Kleinprojects</title>
    
  </head>
  <body>


  


<section class="hero has-background-info-light">
  <div class="hero-header">
    <div class="columns is-centered">
  <div class="column is-half-tablet">
    <nav class="navbar has-shadow" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">
        <a class="navbar-item " href="/">
          <img src="/images/logo.png">
          <span class="ml-1">Kleinprojects</span>
        </a>
      </div>
      <div class="navbar-menu is-active">
        <div class="navbar-start">
          <a class="navbar-item " href="/projects/">
            Projects
          </a>
          <a class="navbar-item is-active" href="/blog/">
            Blog
          </a>
        </div>
        <div class="navbar-end">
          <a class="navbar-item " href="/about/">
            About Me
          </a>
        </div>
      </div>
    </nav>
  </div>
</div>

  </div>
  <div class="hero-body has-text-centered">
    <h1 class="title is-1">Linking Markdown Notes with TypeScript</h1>
    <h2 class="subtitle is-4"></h2>
  </div>
</section>



<main class="container  content">
  <section class="section">
    
<div class="content">
  <p>Networked note taking applications like RoamResearch, Obsidian, and Logseq are getting more and more popular. They pursue the concept of <em>linked</em> notes - that means that instead of dividing notes into sections, they are all in a flat directory and define structure by relations to other notes.
This post dives into an implementation to leverage the power of <code>[[wikilinks]]</code> - links that can point to any location within your note system. I assume knowledge of TypeScript but it's not necessary to grasp the concept and process.</p>
<p><strong>You will have a basis to link any markdown notes through a mapping data structure that gives you direct access to <em>path</em>, <em>title</em>, and <em>links</em> of documents.</strong></p>
<h2>Setup</h2>
<p>At first, we are going to setup our environment and base project. Ensure you have a recent installation of <a href="https://nodejs.org">Node.js</a>. If not head over to their [download page]((https://nodejs.org/en/download/), grab the latest version and install it.
We use the package manager <a href="https://yarnpkg.com/">yarn</a> for dependency management. However, you could also install everything via <a href="https://www.npmjs.com/">npm</a> if you prefer. So, go ahead and install yarn.</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --global <span class="token function">yarn</span></code></pre>
<p>Let's create a new folder for our project and initialize an empty yarn project with default options.</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">mkdir</span> linked-markdown-notes<br><span class="token builtin class-name">cd</span> linked-markdown-notes<br><span class="token function">yarn</span> init -y</code></pre>
<p>Add required dependencies for running the project.</p>
<pre class="language-shell"><code class="language-shell"><span class="token function">yarn</span> <span class="token function">add</span> --dev typescript ts-node @types/node @types/fs-extra<br><span class="token function">yarn</span> <span class="token function">add</span> remark-parse remark-wiki-link unist-util-visit-parents</code></pre>
<p>We are using ESM - therefore add the <code>&quot;type&quot;: &quot;module&quot;</code> option to your <code>package.json</code> and create a <code>start</code> script for running our project.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"linked-markdown-notes"</span><span class="token punctuation">,</span><br>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span><br>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span><br>  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span><br>  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span><br>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"node --loader ts-node/esm src/index.js"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Create a new <code>tsconfig.json</code> file for our <a href="https://www.typescriptlang.org/">TypeScript</a> configuration.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"ESNext"</span><span class="token punctuation">,</span><br>    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"ESNext"</span><span class="token punctuation">,</span><br>    <span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span><br>    <span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"forceConsistentCasingInFileNames"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"skipLibCheck"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token property">"remark-wiki-link"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./typings/remark-wiki-link.d.ts"</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>As the code base of <code>remark-wiki-link</code> is JavaScript and the package ships no types we have to create a new type definition file and reference it in the <code>tsconfig.json</code>.
For this we just create a new file under <code>typings/remark-wiki-link.d.ts</code> with the content</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'remark-wiki-link'</span><span class="token punctuation">;</span></code></pre>
<p>Either use a folder with markdown files you would like to use or create a new <code>test/resources</code> folder that contains some sample markdown files. In this post all examples and code will work with the latter one. If you want to follow this the create 4 files in that folder:</p>
<p><code>test/resources/Dog.md</code></p>
<pre><code># Dog
There is a dog.
</code></pre>
<p><code>test/resources/Cat.md</code></p>
<pre><code># Cat
Cat plays with [[Dog]]
</code></pre>
<p><code>test/resources/Farm.md</code></p>
<pre><code># Farm
Farm has a [[Dog]], a [[Horse]], and a [[Cow]]
</code></pre>
<p><code>test/resources/Home.md</code></p>
<pre><code># Home
Home has a [[Cat]] and [[Dog]]
</code></pre>
<p>Content of the files make no real sense - we'll use these files as a basis to test the <code>[[...]]</code> links.
Eventually, our folder structure should look this:</p>
<pre><code>test/
  resources/
    Dog.md
    Cat.md
    Home.md
    Farm.md
typings/
  remark-wiki-link.d.ts
package.json
tsconfig.json
</code></pre>
<p><strong>With our base setup we are good to go and dive into the actual implementation.</strong></p>
<h2>Reading Markdown Files</h2>
<p>Let's write some code. Create a new file under <code>src/index.ts</code> - this is our application entry. Add the following function that reads in markdown files of a specific directory.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'node:fs/promises'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span><br><br><span class="token keyword">interface</span> <span class="token class-name">FileSystemDocument</span> <span class="token punctuation">{</span><br>  path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>  content<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">/**<br> * Reads all markdown files of a directory.<br> *<br> * @param directoryPath Directory to read.<br> * @returns Path and content of markdown files within the directory.<br> */</span><br><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">readMarkdownFiles</span><span class="token punctuation">(</span><br>  directoryPath<span class="token operator">:</span> <span class="token builtin">string</span><br><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>FileSystemDocument<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token punctuation">{</span><br>  <span class="token comment">// read files in folder</span><br>  <span class="token keyword">const</span> dirents <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>directoryPath<span class="token punctuation">,</span> <span class="token punctuation">{</span> withFileTypes<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// filter files from folder</span><br>  <span class="token keyword">const</span> files <span class="token operator">=</span> dirents<br>    <span class="token comment">// only consider files that have a markdown extension</span><br>    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>dirent <span class="token operator">=></span> dirent<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>dirent<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'.md'</span><span class="token punctuation">)</span><br>    <span class="token comment">// return path of file</span><br>    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>dirent <span class="token operator">=></span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>directoryPath<span class="token punctuation">,</span> dirent<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// read file contents</span><br>  <span class="token keyword">const</span> filesWithContentPromises <span class="token operator">=</span> files<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><br>    <span class="token keyword">async</span> <span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>FileSystemDocument<span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span><br>      path<span class="token operator">:</span> filePath<span class="token punctuation">,</span><br>      <span class="token comment">// read content of file</span><br>      content<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// resolve asynchronous file loading</span><br>  <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>filesWithContentPromises<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// call function with our test repository</span><br><span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readMarkdownFiles</span><span class="token punctuation">(</span><span class="token string">'./test/resources'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// prints results</span><br>files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Read file path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Run the code snippet and see its result:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">yarn</span> start</code></pre>
<p>It should print a list of markdown files in our <code>test/resources</code> folder:</p>
<pre class="language-bash"><code class="language-bash">Read <span class="token function">file</span> path: test/resources/Cat.md<br>Read <span class="token function">file</span> path: test/resources/Dog.md<br>Read <span class="token function">file</span> path: test/resources/Farm.md<br>Read <span class="token function">file</span> path: test/resources/Home.md</code></pre>
<p><strong>Nice. We are set with our files. Now we can really start with file parsing and linking...</strong></p>
<h2>Parsing Markdown Files</h2>
<p>We use <a href="https://github.com/remarkjs/remark/tree/main/packages/remark-parse">remark-parse</a> for markdown parsing with the <a href="https://github.com/landakram/remark-wiki-link">remark-wiki-link</a> extension for parsing wikilinks of the format <code>[[...]]</code>. To leverage the power of typings we start with the creation of a <code>WikiLinkNode</code> type that we need for the <code>remark-wiki-plugin</code> and then we create a custom <code>SyntaxTree</code> type that combines the root type of the parsers syntax tree and the wiki link plugin. Additionally, let us import <code>visit</code> - an utility to traverse through the syntax tree - see <a href="https://unifiedjs.com/learn/recipe/tree-traversal-typescript/">tree traversal article in TypeScript</a> for more information about that.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// ... other imports</span><br><span class="token keyword">import</span> <span class="token constant">MDAST</span> <span class="token keyword">from</span> <span class="token string">'mdast'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token constant">UNIST</span> <span class="token keyword">from</span> <span class="token string">'unist'</span><span class="token punctuation">;</span><br><span class="token comment">// gonna need visit for our next function</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> visit <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'unist-util-visit'</span><span class="token punctuation">;</span><br><br><span class="token keyword">interface</span> <span class="token class-name">WikiLinkNode</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">UNIST</span></span><span class="token punctuation">.</span>Node <span class="token punctuation">{</span><br>  type<span class="token operator">:</span> <span class="token string">'wikiLink'</span><span class="token punctuation">;</span><br>  value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>  data<span class="token operator">:</span> <span class="token punctuation">{</span><br>    alias<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>    permalink<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token keyword">type</span> <span class="token class-name">SyntaxTree</span> <span class="token operator">=</span> mdast<span class="token punctuation">.</span>Root <span class="token operator">|</span> WikiLinkNode<span class="token punctuation">;</span></code></pre>
<p><a href="https://github.com/syntax-tree/unist">Unist</a> and <a href="https://github.com/syntax-tree/mdast">mdast</a> are syntax tree structures <code>remark-parse</code> uses for parsing markdown.
In the next step we add two more functions to parse all document links and build a mapping table from all documents and links. Let's start with a function to parse wiki links from our syntax tree. For this we are going to use the <code>visit</code> utility we imported in the previous snippet.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">parseDocumentLinks</span><span class="token punctuation">(</span>parsedDocumentContent<span class="token operator">:</span> SyntaxTree<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> documentLinks<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token function">visit</span><span class="token punctuation">(</span>parsedDocumentContent<span class="token punctuation">,</span> <span class="token string">'wikiLink'</span><span class="token punctuation">,</span> wikiLinkNode <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> value <span class="token operator">=</span> wikiLinkNode<span class="token punctuation">.</span>value<span class="token punctuation">;</span><br>    <span class="token keyword">const</span> alias <span class="token operator">=</span> wikiLinkNode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>alias<span class="token punctuation">;</span><br>    <span class="token comment">// if a link contains a ":" the remark-wiki-link plugin would parse it as an alias</span><br>    <span class="token comment">// as we are not using the alias feature we re-construct the full link content</span><br>    <span class="token comment">// LIMITATION: this approach does not recognize links that have the same name and alias</span><br>    <span class="token comment">// e.g. name:name - keep that in mind when using this snippet</span><br>    <span class="token keyword">const</span> linkName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>wikiLinkNode<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>      value <span class="token operator">!==</span> alias <span class="token operator">?</span> <span class="token string">':'</span> <span class="token operator">+</span> alias <span class="token operator">:</span> <span class="token string">''</span><br>    <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>    documentLinks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>linkName<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> documentLinks<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>The function returns an array of wiki links it finds in the syntax tree. With this we can add our function for building the document to links map.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">buildDocumentsLinkMap</span><span class="token punctuation">(</span>files<span class="token operator">:</span> FileSystemDocument<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// call the unified parser</span><br>  <span class="token keyword">const</span> documentParser <span class="token operator">=</span> <span class="token function">unified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>remarkParse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>remarkWikiLink<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// end result</span><br>  <span class="token keyword">const</span> documentLinksMap<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token punctuation">,</span> content <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// parse each content and put its links into our result map</span><br>    <span class="token keyword">const</span> parsedDocumentContent <span class="token operator">=</span> documentParser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    documentLinksMap<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">parseDocumentLinks</span><span class="token punctuation">(</span>parsedDocumentContent<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> documentLinksMap<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token comment">// print our result</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Document links map: '</span><span class="token punctuation">,</span> <span class="token function">buildDocumentsLinkMap</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Running our program will now yield something like this:</p>
<pre class="language-bash"><code class="language-bash">Read <span class="token function">file</span> path: test/resources/Cat.md<br>Read <span class="token function">file</span> path: test/resources/Dog.md<br>Read <span class="token function">file</span> path: test/resources/Farm.md<br>Read <span class="token function">file</span> path: test/resources/Home.md<br>Documents links map: <span class="token punctuation">{</span><br>  <span class="token string">'test/resources/Cat.md'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">'Dog'</span> <span class="token punctuation">]</span>,<br>  <span class="token string">'test/resources/Dog.md'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,<br>  <span class="token string">'test/resources/Farm.md'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">'Dog'</span>, <span class="token string">'Horse'</span>, <span class="token string">'Cow'</span> <span class="token punctuation">]</span>,<br>  <span class="token string">'test/resources/Home.md'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">'Cat'</span>, <span class="token string">'Dog'</span> <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p><strong>Voil√† - we successfully parsed our markdown files, extracted links, and created a mapping table. With this mapping table we can easily match documents and links. The next sections discuss how we can implement that mapping.</strong></p>
<h2>Extracting Document Titles</h2>
<p>Our links have to map against some sort of name or title. In our case we are using the document title as the matching target. However, you could also use for example the first heading in you markdown file. It's just important that we create a map of titles that the document links map can use for consecutive linking.
Therefore, we add a new function for extracting document titles</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">buildDocumentsTitleMap</span><span class="token punctuation">(</span>files<span class="token operator">:</span> FileSystemDocument<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> documentTitleMap<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// extract document title</span><br>    <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">([^\/]+)\.md$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?.</span><span class="token punctuation">[</span><span class="token prism-number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>    <span class="token comment">// verify a consistent mapping</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>title<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Could not extract title from path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>documentTitleMap<span class="token punctuation">[</span>title<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><br>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><br>        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Title "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" already exists for path "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>documentTitleMap<span class="token punctuation">[</span>title<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">".</span><span class="token template-punctuation string">`</span></span><br>      <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    documentTitleMap<span class="token punctuation">[</span>title<span class="token punctuation">]</span> <span class="token operator">=</span> path<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> documentTitleMap<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Documents title map: '</span><span class="token punctuation">,</span> <span class="token function">buildDocumentsTitleMap</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The regex <code>([^\/]+)\.md$</code> returns the title of a document and the first matching group contains the title. Additionally, the function contains two additional checks to guarantee uniqueness of titles.
A run with <code>yarn start</code> now prints</p>
<pre class="language-bash"><code class="language-bash">Read <span class="token function">file</span> path: test/resources/Cat.md<br>Read <span class="token function">file</span> path: test/resources/Dog.md<br>Read <span class="token function">file</span> path: test/resources/Farm.md<br>Read <span class="token function">file</span> path: test/resources/Home.md<br>Documents links map:  <span class="token punctuation">{</span><br>  <span class="token string">'test/resources/Cat.md'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">'Dog'</span> <span class="token punctuation">]</span>,<br>  <span class="token string">'test/resources/Dog.md'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,<br>  <span class="token string">'test/resources/Farm.md'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">'Dog'</span>, <span class="token string">'Horse'</span>, <span class="token string">'Cow'</span> <span class="token punctuation">]</span>,<br>  <span class="token string">'test/resources/Home.md'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">'Cat'</span>, <span class="token string">'Dog'</span> <span class="token punctuation">]</span><br><span class="token punctuation">}</span><br>Documents title map:  <span class="token punctuation">{</span><br>  Cat: <span class="token string">'test/resources/Cat.md'</span>,<br>  Dog: <span class="token string">'test/resources/Dog.md'</span>,<br>  Farm: <span class="token string">'test/resources/Farm.md'</span>,<br>  Home: <span class="token string">'test/resources/Home.md'</span><br><span class="token punctuation">}</span></code></pre>
<p><strong>Well done - with the documents links map and the documents title map we can interlink our markdown files.</strong></p>
<h2>Building Master Mappings</h2>
<p>You might already wonder how we could actually map all links with the mapping tables that we got now. Therefore, for our final mapping we create mappings based on our two original mapping tables and combine them all! They will enable any future algorithms to directly find mappings for links.
Let's add a function that creates our master mapping tables:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">function</span> <span class="token function">buildMasterMappings</span><span class="token punctuation">(</span><br>  documentTitleToPathMap<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  documentPathToLinksMap<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><br><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// create interim mapping tables to easily map entries</span><br>  <span class="token keyword">const</span> documentPathToTitleMap<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>path<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>documentTitleToPathMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><br>    <span class="token punctuation">(</span><span class="token punctuation">[</span>title<span class="token punctuation">,</span> path<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>documentPathToTitleMap<span class="token punctuation">[</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> title<span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> documentTitleToLinksMap<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>title<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>documentPathToLinksMap<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><br>    <span class="token punctuation">(</span><span class="token punctuation">[</span>path<span class="token punctuation">,</span> links<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span><br>      <span class="token comment">// map document title to links</span><br>      <span class="token punctuation">(</span>documentTitleToLinksMap<span class="token punctuation">[</span>documentPathToTitleMap<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> links<span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// return all mappings</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    documentTitleToPathMap<span class="token punctuation">,</span><br>    documentPathToLinksMap<span class="token punctuation">,</span><br>    documentPathToTitleMap<span class="token punctuation">,</span><br>    documentTitleToLinksMap<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><br>  <span class="token string">'Master mappings: '</span><span class="token punctuation">,</span><br>  <span class="token function">buildMasterMappings</span><span class="token punctuation">(</span><br>    <span class="token function">buildDocumentsTitleMap</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token function">buildDocumentsLinkMap</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>A re-run of our project with <code>yarn start</code> will now yield</p>
<pre class="language-bash"><code class="language-bash"><span class="token punctuation">..</span>. <span class="token punctuation">(</span>output from above<span class="token punctuation">)</span><br>Master mappings:  <span class="token punctuation">{</span><br>  documentTitleToPathMap: <span class="token punctuation">{</span><br>    Cat: <span class="token string">'test/resources/Cat.md'</span>,<br>    Dog: <span class="token string">'test/resources/Dog.md'</span>,<br>    Farm: <span class="token string">'test/resources/Farm.md'</span>,<br>    Home: <span class="token string">'test/resources/Home.md'</span><br>  <span class="token punctuation">}</span>,<br>  documentPathToLinksMap: <span class="token punctuation">{</span><br>    <span class="token string">'test/resources/Cat.md'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">'Dog'</span> <span class="token punctuation">]</span>,<br>    <span class="token string">'test/resources/Dog.md'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,<br>    <span class="token string">'test/resources/Farm.md'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">'Dog'</span>, <span class="token string">'Horse'</span>, <span class="token string">'Cow'</span> <span class="token punctuation">]</span>,<br>    <span class="token string">'test/resources/Home.md'</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token string">'Cat'</span>, <span class="token string">'Dog'</span> <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span>,<br>  documentPathToTitleMap: <span class="token punctuation">{</span><br>    <span class="token string">'test/resources/Cat.md'</span><span class="token builtin class-name">:</span> <span class="token string">'Cat'</span>,<br>    <span class="token string">'test/resources/Dog.md'</span><span class="token builtin class-name">:</span> <span class="token string">'Dog'</span>,<br>    <span class="token string">'test/resources/Farm.md'</span><span class="token builtin class-name">:</span> <span class="token string">'Farm'</span>,<br>    <span class="token string">'test/resources/Home.md'</span><span class="token builtin class-name">:</span> <span class="token string">'Home'</span><br>  <span class="token punctuation">}</span>,<br>  documentTitleToLinksMap: <span class="token punctuation">{</span><br>    Cat: <span class="token punctuation">[</span> <span class="token string">'Dog'</span> <span class="token punctuation">]</span>,<br>    Dog: <span class="token punctuation">[</span><span class="token punctuation">]</span>,<br>    Farm: <span class="token punctuation">[</span> <span class="token string">'Dog'</span>, <span class="token string">'Horse'</span>, <span class="token string">'Cow'</span> <span class="token punctuation">]</span>,<br>    Home: <span class="token punctuation">[</span> <span class="token string">'Cat'</span>, <span class="token string">'Dog'</span> <span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p><strong>You see where this is getting? Now we got mappings into all directions with all document titles, paths, and links. Now we just have to use it.</strong></p>
<h2>Mapping Links to Document Paths</h2>
<p>We could utilize these master mappings in various use cases. To look into one in particular we implement a function to map links to the respective file path. Note, that some links don't have a matching target document - our function considers this case as well.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// we build a global master mapping table</span><br><span class="token comment">// so we can reuse it later</span><br><span class="token keyword">const</span> globalMasterMapping <span class="token operator">=</span> <span class="token function">buildMasterMappings</span><span class="token punctuation">(</span><br>  <span class="token function">buildDocumentsTitleMap</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token function">buildDocumentsLinkMap</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">findDocumentPathOfLink</span><span class="token punctuation">(</span><br>  masterMapping<span class="token operator">:</span> ReturnType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> buildMasterMappings<span class="token operator">></span><span class="token punctuation">,</span><br>  linkName<span class="token operator">:</span> <span class="token builtin">string</span><br><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> linkPath <span class="token operator">=</span> masterMapping<span class="token punctuation">.</span>documentTitleToPathMap<span class="token punctuation">[</span>linkName<span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    <span class="token comment">// return true, if the path exists</span><br>    <span class="token comment">// if false, there is no document for the link name</span><br>    existing<span class="token operator">:</span> linkPath <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span><br>    path<span class="token operator">:</span> linkPath<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Eventually, let us print some results of that function:</p>
<pre class="language-ts"><code class="language-ts"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><br>  <span class="token string">'Path for link Home: '</span><span class="token punctuation">,</span><br>  <span class="token function">findDocumentPathOfLink</span><span class="token punctuation">(</span>globalMasterMapping<span class="token punctuation">,</span> <span class="token string">'Home'</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><br>  <span class="token string">'Path for link Farm: '</span><span class="token punctuation">,</span><br>  <span class="token function">findDocumentPathOfLink</span><span class="token punctuation">(</span>globalMasterMapping<span class="token punctuation">,</span> <span class="token string">'Farm'</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><br>  <span class="token string">'Path for link Farm: '</span><span class="token punctuation">,</span><br>  <span class="token function">findDocumentPathOfLink</span><span class="token punctuation">(</span>globalMasterMapping<span class="token punctuation">,</span> <span class="token string">'Cow'</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>A run with <code>yarn start</code> now logs:</p>
<pre class="language-bash"><code class="language-bash">Path <span class="token keyword">for</span> <span class="token function">link</span> Home:  <span class="token punctuation">{</span> existing: true, path: <span class="token string">'test/resources/Home.md'</span> <span class="token punctuation">}</span><br>Path <span class="token keyword">for</span> <span class="token function">link</span> Farm:  <span class="token punctuation">{</span> existing: true, path: <span class="token string">'test/resources/Farm.md'</span> <span class="token punctuation">}</span><br>Path <span class="token keyword">for</span> <span class="token function">link</span> Farm:  <span class="token punctuation">{</span> existing: false, path: undefined <span class="token punctuation">}</span></code></pre>
<p><strong>This case shows us how easy it is to utilise the master mapping to quickly find paths for linked notes.</strong></p>
<h2>Limitations and Outlook</h2>
<p>This post covered a basic implementation for processing linked Markdown notes. Feel free to take it as an inspiration and let me know if you do something cool with it. Nonetheless, there is much more to come and we are only at the very beginning.
Try to experiment with the implementation a little. You could for example use some <a href="https://en.wikipedia.org/wiki/PageRank">PageRank Algorithm</a> for sorting documents by the amount of links. Additionally, there are many more cases that I am currently working on that all need this base of interconnected notes:</p>
<ol>
<li>Are all notes connected with each other, or are there outsiders? This might be indications for lost notes.</li>
<li>What links don't have a mapping target? This would be links that point to non-existent documents.</li>
<li>Which links point to a specific document (also known as <em>backlinks</em>)?</li>
</ol>
<p><strong>Enjoy working with your set of linked notes.</strong></p>
<p>Cheers, Marco</p>

</div>

  </section>
</main>


<footer class="footer">
  <div class="content has-text-centered">
    <p>
      <a href="/legal/">Legal Notice</a>
    </p>
    <p>
      &copy; Marco Klein 2021
    </p>
  </div>
</footer>


</body>
</html>
